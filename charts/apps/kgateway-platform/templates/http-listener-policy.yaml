{{- if .Values.httpListenerPolicy.enabled }}
{{- $namespace := include "kgateway-platform.namespace" . -}}
{{- $fullname := include "kgateway-platform.fullname" . -}}
{{- $targetGateway := .Values.httpListenerPolicy.targetGateway | default "public" -}}
{{- $cfg := index .Values.gateways $targetGateway -}}
{{- if and $cfg $cfg.enabled }}
{{- $name := default (printf "%s-%s" $fullname $targetGateway) $cfg.name -}}
---
apiVersion: gateway.kgateway.dev/v1alpha1
kind: HTTPListenerPolicy
metadata:
  name: {{ default (printf "%s-websocket-upgrade" $name) .Values.httpListenerPolicy.name }}
  namespace: {{ $namespace }}
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: {{ $name }}
      namespace: {{ $namespace }}
  upgradeConfig:
    enabledUpgrades:
{{- range $upgrade := .Values.httpListenerPolicy.enabledUpgrades }}
      - {{ $upgrade | quote }}
{{- end }}
{{- end }}
{{- end }}