{{- if and .Values.httpListenerPolicy.enabled .Values.gateways.public.enabled }}
{{- $namespace := include "kgateway-platform.namespace" . -}}
{{- $fullname := include "kgateway-platform.fullname" . -}}
{{- $cfg := .Values.gateways.public -}}
{{- $name := default (printf "%s-public" $fullname) $cfg.name -}}
---
apiVersion: gateway.kgateway.dev/v1alpha1
kind: HTTPListenerPolicy
metadata:
  name: {{ default (printf "%s-websocket-upgrade" $name) .Values.httpListenerPolicy.name }}
  namespace: {{ $namespace }}
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: {{ $name }}
      namespace: {{ $namespace }}
  upgradeConfig:
    enabledUpgrades:
{{- range $upgrade := .Values.httpListenerPolicy.enabledUpgrades }}
      - {{ $upgrade | quote }}
{{- end }}
{{- end }}