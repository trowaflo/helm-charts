suite: test kgateway-platform chart - gateway configuration
release:
  name: kgateway-platform-test
  namespace: kgateway-test
capabilities:
  apiVersions:
    - gateway.networking.k8s.io/v1/Gateway
    - gateway.kgateway.dev/v1alpha1/GatewayParameters
templates:
  - templates/gateways.yaml
tests:
  # Test gateway addresses are rendered correctly
  # Note: Gateways are rendered in alphabetical order (private, then public)
  - it: should render gateway with correct IP addresses
    values:
      - values/default.yaml
    asserts:
      - equal:
          path: spec.addresses[0].value
          value: "192.168.1.2"
        documentIndex: 0
      - equal:
          path: spec.addresses[0].value
          value: "192.168.1.1"
        documentIndex: 1

  # Test TLS certificate references
  - it: should reference correct TLS secret
    values:
      - values/default.yaml
    asserts:
      - equal:
          path: spec.listeners[1].tls.certificateRefs[0].name
          value: test-tls-secret
        documentIndex: 0
      - equal:
          path: spec.listeners[1].tls.certificateRefs[0].namespace
          value: cert-namespace
        documentIndex: 0

  # Test gateway parameters reference
  - it: should reference correct GatewayParameters
    values:
      - values/default.yaml
    asserts:
      - equal:
          path: spec.infrastructure.parametersRef.name
          value: kgateway-platform-test-private-params
        documentIndex: 0
      - equal:
          path: spec.infrastructure.parametersRef.name
          value: kgateway-platform-test-public-params
        documentIndex: 1
