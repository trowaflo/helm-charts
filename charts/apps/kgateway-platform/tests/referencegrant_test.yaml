suite: test kgateway-platform chart - ReferenceGrant
release:
  name: kgateway-platform-test
  namespace: kgateway-test
templates:
  - templates/referencegrant-certificates.yaml
tests:
  # Test with TLS secret in different namespace
  - it: should render ReferenceGrant when TLS secret is in different namespace
    values:
      - values/default.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ReferenceGrant
      - equal:
          path: metadata.namespace
          value: cert-namespace
      - equal:
          path: spec.from[0].namespace
          value: kgateway-test
      - equal:
          path: spec.to[0].name
          value: test-tls-secret

  # Test with TLS secret in same namespace (empty string)
  - it: should not render ReferenceGrant when TLS secret namespace is empty
    values:
      - values/same-namespace-tls.yaml
    asserts:
      - hasDocuments:
          count: 0
