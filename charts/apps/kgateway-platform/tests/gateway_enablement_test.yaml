suite: test kgateway-platform chart - gateway enablement
release:
  name: kgateway-platform-test
  namespace: kgateway-test
capabilities:
  apiVersions:
    - gateway.networking.k8s.io/v1/Gateway
    - gateway.kgateway.dev/v1alpha1/GatewayParameters
templates:
  - templates/gateways.yaml
tests:
  # Test with default values (both gateways enabled)
  # Note: Gateways are rendered in alphabetical order (private, then public)
  - it: should render both gateways when enabled
    values:
      - values/default.yaml
    asserts:
      - hasDocuments:
          count: 2  # 2 gateways
      - isKind:
          of: Gateway
        documentIndex: 0
      - equal:
          path: metadata.name
          value: kgateway-platform-test-private
        documentIndex: 0
      - isKind:
          of: Gateway
        documentIndex: 1
      - equal:
          path: metadata.name
          value: kgateway-platform-test-public
        documentIndex: 1

  # Test with public gateway disabled
  - it: should only render private gateway when public is disabled
    values:
      - values/disable-public.yaml
    asserts:
      - hasDocuments:
          count: 1  # 1 gateway
      - isKind:
          of: Gateway
        documentIndex: 0
      - equal:
          path: metadata.name
          value: kgateway-platform-test-private
        documentIndex: 0

  # Test with private gateway disabled
  - it: should only render public gateway when private is disabled
    values:
      - values/disable-private.yaml
    asserts:
      - hasDocuments:
          count: 1  # 1 gateway
      - isKind:
          of: Gateway
        documentIndex: 0
      - equal:
          path: metadata.name
          value: kgateway-platform-test-public
        documentIndex: 0
