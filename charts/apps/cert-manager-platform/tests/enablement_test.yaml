suite: test cert-manager chart - basic functionality
release:
  name: cert-manager-testing
  namespace: cert-manager
templates:
  - templates/NOTES.txt
tests:
  # Test with default values
  - it: should render successfully with default values
    values:
      - values/default.yaml
    asserts:
      - isNotNull:
          path: raw
      - matchRegex:
          path: raw
          pattern: "cert-manager: true"
      - matchRegex:
          path: raw
          pattern: "CRDs: true"
      - matchRegex:
          path: raw
          pattern: "cert-manager-webhook-ovh: true"
      - matchRegex:
          path: raw
          pattern: "configVersion: 0.0.2"

  # Test with cert-manager disabled
  - it: should render successfully with cert-manager disabled
    values:
      - values/disable-cert-manager.yaml
    asserts:
      - isNotNull:
          path: raw
      - matchRegex:
          path: raw
          pattern: "cert-manager: false"

  # Test with CRDs disabled
  - it: should render successfully with CRDs disabled
    values:
      - values/disable-crds.yaml
    asserts:
      - isNotNull:
          path: raw
      - matchRegex:
          path: raw
          pattern: "CRDs: false"

  # Test with webhook disabled
  - it: should render successfully with webhook disabled
    values:
      - values/disable-webhook.yaml
    asserts:
      - isNotNull:
          path: raw
      - matchRegex:
          path: raw
          pattern: "cert-manager-webhook-ovh: false"
