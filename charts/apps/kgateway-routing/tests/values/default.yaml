# In-cluster route example (like argocd from the issue)
routes:
  argocd:
    enabled: true
    hostnames:
      - "argocd.example.com"
    parentRefs:
      - name: private-gateway
        namespace: kgateway-preview
    rules:
      - matches:
          - path:
              type: PathPrefix
              value: /
        backendRefs:
          - group: ''
            kind: Service
            name: argocd-server
            port: 80
            weight: 1

# Out-cluster route with filters (like homeassistant from the issue)
  homeassistant:
    enabled: true
    hostnames:
      - "hass.example.com"
    parentRefs:
      - name: public-gateway
        namespace: kgateway-preview
    rules:
      - matches:
          - path:
              type: PathPrefix
              value: /
        backendRefs:
          - name: homeassistant-backend
            kind: Backend
            group: gateway.kgateway.dev
            weight: 1
        filters:
          - type: RequestHeaderModifier
            requestHeaderModifier:
              set:
                - name: X-Forwarded-Proto
                  value: https
                - name: X-Forwarded-Port
                  value: "443"
                - name: X-Forwarded-Host
                  value: hass.example.com
          - type: ResponseHeaderModifier
            responseHeaderModifier:
              set:
                - name: Content-Security-Policy
                  value: "upgrade-insecure-requests"

backends:
  homeassistant:
    enabled: true
    type: Static
    static:
      hosts:
        - host: homeassistant.local
          port: 8123
