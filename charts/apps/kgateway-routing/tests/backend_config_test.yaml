suite: test kgateway-routing chart - Backend configuration
release:
  name: kgateway-routing-test
  namespace: kgateway-test
templates:
  - templates/backend.yaml
tests:
  # Test Static backend rendering
  - it: should render Static Backend correctly
    values:
      - values/only-outcluster.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Backend
      - equal:
          path: apiVersion
          value: gateway.kgateway.dev/v1alpha1
      - equal:
          path: metadata.name
          value: homeassistant-backend
      - equal:
          path: metadata.namespace
          value: kgateway-test
      - equal:
          path: spec.type
          value: Static
      - equal:
          path: spec.static.hosts[0].host
          value: homeassistant.local
      - equal:
          path: spec.static.hosts[0].port
          value: 8123

  # Test Backend with custom name
  - it: should use custom backend name when provided
    set:
      backends:
        custom:
          enabled: true
          name: my-custom-backend
          type: Static
          static:
            hosts:
              - host: example.com
                port: 443
    asserts:
      - hasDocuments:
          count: 1
      - equal:
          path: metadata.name
          value: my-custom-backend

  # Test Backend in custom namespace
  - it: should render Backend in custom namespace when specified
    set:
      backends:
        mybackend:
          enabled: true
          namespace: custom-namespace
          type: Static
          static:
            hosts:
              - host: example.com
                port: 443
    asserts:
      - hasDocuments:
          count: 1
      - equal:
          path: metadata.namespace
          value: custom-namespace
