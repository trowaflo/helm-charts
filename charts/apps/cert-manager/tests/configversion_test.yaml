suite: test cert-manager chart - webhook configVersion validation
templates:
  - templates/NOTES.txt
release:
  name: cert-manager-testing
  namespace: cert-manager

tests:
  - it: should fail when configVersion is missing
    values:
      - values/configversion-missing.yaml
    asserts:
      - failedTemplate:
          errorMessage: "The 'configVersion' key cannot be empty when cert-manager-webhook-ovh is enabled. Please set .Values.cert-manager-webhook-ovh.configVersion to '0.0.2'"

  - it: should fail when configVersion is wrong
    values:
      - values/configversion-wrong.yaml
    asserts:
      - failedTemplate:
          errorMessage: "Incorrect 'configVersion': Expected: '0.0.2', Provided: '0.0.1'"

  - it: should succeed when configVersion is correct
    values:
      - values/default.yaml
    asserts:
      - isNotNull:
          path: raw
      - matchRegex:
          path: raw
          pattern: "cert-manager has been installed successfully"
